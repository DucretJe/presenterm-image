FROM golang:bookworm@sha256:c485c19781bc450b984ab7d961f364560ce2942f1905ca8cb99031a0bc84283b as builder

# renovate: datasource=repology depName=debian_12/git versioning=loose
ENV GIT_VER 2.39.2

# False positive in HADOLINT, the version is pinned
# hadolint ignore=DL3008
RUN apt-get update && apt-get install --no-install-recommends -y \
    "?and(?exact-name(git),?version(:${GIT_VER}))" && \
    rm -rf /var/lib/apt/lists/*

FROM builder as build

ENV CGO_ENABLED=0
RUN git clone https://github.com/maaslalani/slides.git
WORKDIR /go/slides
RUN go build

FROM alpine:3@sha256:34871e7290500828b39e22294660bee86d966bc0017544e848dd9a255cdf59e0 as slides

# renovate: datasource=repology depName=alpine_3_18/chafa versioning=loose
ENV CHAFA_VER 1.12.5

RUN apk add --no-cache \
    chafa~="${CHAFA_VER}"

COPY --from=build /go/slides/slides /usr/local/bin/slides

HEALTHCHECK NONE

ENTRYPOINT ["/usr/local/bin/slides"]
